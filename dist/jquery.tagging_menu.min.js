"function"!=typeof Object.create&&(Object.create=function(a){function b(){}return b.prototype=a,new b}),function(a,b,c){var d=!1,e=null,f=0,g={init:function(b,c,d){var e=this;e.$elem=c,e.$menu=d,e.options=a.extend({},e.$elem.data(),b),e.tfOff=parseInt(e.$elem.data("off"),10),e.endOff=e.tfOff+1,e.$tile=null,e.menuW=null,e._create()},select:function(b){var c=this;b.$text=c.$elem,b.selStart=c.tfOff,c.endOff=b.selEnd=c.tfOff+parseInt(b.$selTile.data("len")||"1",10),b.$prevTile&&(b.prevStart=c.tfOff,b.prevEnd=c.tfOff+parseInt(b.$prevTile.data("len")||"1",10)),c.$tile=b.$selTile;var d=b.$selTile.data("fsk");c.$elem.data("fsk",d).addClass("idl-tagged idl-mantagged").removeClass("idl-untagged"),c.$elem.parent().trigger("tm_itl_sensesel",b);var e=!0;if("function"==typeof c.options.sensesel&&(e=c.options.sensesel.call(this,b)),e)if("tile"===c.options.wordsContent)c.$elem[0].innerHTML=b.$selTile[0].outerHTML,c.$elem.senseCard({lgcc:c.options.senseMenuOptions.lgcc,deleted:function(){c._deletedWordTileEH(a(this))}});else{var f=c.$elem,g="";do g+=f.data("tok")||f.text(),f=f.next();while(f.length&&(!f.data("off")||f.data("off")<c.endOff));c.$elem.text(g.trim().replace(/ /g,"_"))}c.options.closeOnSelect&&c.close()},deselect:function(){var a=this;a.$elem.addClass("idl-untagged").removeClass("idl-tagged idl-mantagged").removeData("fsk"),a.endOff=a.tfOff+1;var b={selStart:a.tfOff,selEnd:a.tfOff+1};a.$tile&&(b.prevStart=a.tfOff,b.prevEnd=a.tfOff+parseInt(a.$tile.data("len")||"1",10)),a.$elem.parent().trigger("tm_itl_sensesel",b);var c=!0;"function"==typeof a.options.sensedesel&&(c=a.options.sensedesel.call(this,event)!==!1),c&&a.$elem.text(a.$elem.data("tok"))},setSelected:function(a){this.menuW.select(a)},selected:function(){return this.menuW.selected()},setView:function(a){this.menuW.setView(a)},polysemous:function(){return this.$menu.find(".idl-tile-container").length>1},startOffset:function(){return this.tfOff},endOffset:function(){return this.endOff},_bodyClickHandler:function(b){a(b.target).closest(".idl-sensemenu").length>0||(!d&&e&&e.close(),d=!1)},_monitorBodyClicks:function(b){var d=this;d.options.closeOnOutsideClick&&(b?(0===f&&a(c.body).on("click",d._bodyClickHandler),f++):(--f,0===f&&a(c.body).off("click",d._bodyClickHandler)))},open:function(){var a=this;a.$elem.is(":visible")&&("function"==typeof a.options.beforeOpen&&a.options.beforeOpen(this),a._monitorBodyClicks(!0),e&&e.close(),a.options.useToolTip&&a._popover({show:!1}),a.menuW.open(),a.$elem.addClass("idl-active"),e=a,d=!0)},close:function(){if(e==this){var a=this;a._monitorBodyClicks(!1),e=null,a.menuW.close(),a.$elem.removeClass("idl-active"),"function"==typeof a.options.afterClose&&a.options.afterClose(this)}},destroy:function(){var a=this;a.menuW.destroy(),a.options.useToolTip&&a._popover({show:!1})},_popover:function(a){var b=this;a.hasOwnProperty("show")&&(b.showingPopup=a.show);var c=b.$elem;c.popover("destroy"),b.showingPopup&&a.content&&(c.popover({content:a.content,container:!1,html:!0,placement:"auto",delay:500,trigger:"hover",animation:!1}),c.popover("show"))},_create:function(){var b=this;"tile"===b.options.wordsContent&&b._setWordTile(),b.menuW=b.$menu.senseMenu(a.extend({},b.options.senseMenuOptions,{sensesel:function(a){b.select(a)},createsel:function(a){a.$text=b.$elem,b.options.createsel(a),b.options.closeOnSelect&&b.close()}})).data("senseMenu"),b.$elem.on({click:function(a){b.$elem.hasClass("idl-active")?b.close():b.open()}}),b.$elem.addClass("idl-untagged")},_setWordTile:function(){var b=this,c=b.$menu.find(".idl-sensesel").first();0===c.length&&(c=b.$menu.find(".idl-tile-container[data-grp]").first()),0===c.length&&(c=b.$menu.find(".idl-tile-other")),0===c.length&&(c=b.$menu.find(".idl-tile-any")),0===c.length&&(c=a('<div class="idl-tile-container idl-menu-sensecard idl-sensesel idl-tile-text idl-tmplt-menu_image_v3" data-grp="1"><div class="idl-sensetile"><div class="idl-tile-sum"><h1>'+b.$elem.data("tok")+'</h1></div><div class="idl-def"><p>Any sense (no known meaning).</p></div></div></div>')),b.$tile=c,b.$elem[0].innerHTML=c[0].outerHTML},_deletedWordTileEH:function(a){var b=this,c=a.data("fsk"),d=".idl-tile-container[data-fsk='"+c+"']";b.$menu.find(d).remove(),b._setWordTile()},_skToLemma:function(a){var b=a.lastIndexOf("/");return-1!=b&&(a=a.substr(0,b)),a.replace(/_/g," ")}},h={init:function(a,b,c){var d=this;d.$elem=a,d.tfOff=b,d.isWord=c},startOffset:function(){return this.tfOff},endOffset:function(){return this.isWord?this.tfOff+1:this.tfOff}},i={init:function(b,c){var d=this;d.$elem=a(c),d.options=a.extend({},a.fn.taggingMenu.options,d.$elem.data(),b),d.words=[],d.gaps=[],d.sensecards={},d.tmplt=b.menus.children().first().data("tmplt"),d._create()},text:function(){var b=this,c="";return b.$elem.children().each(function(b,d){$elem=a(d),$elem.is(":visible")&&(c+=$elem.text())}),c},senses:function(){var b=this,c="";return b.$elem.children().each(function(b,d){if($elem=a(d),"inline"==$elem.css("display")||$elem.hasClass("hidden")){if($elem.hasClass("idl-tagged")){var e=$elem.data("fsk");if(e)return void(c+=e)}c+=$elem.data("tok")||$elem.text()}}),c},sensesAsObjects:function(){for(var b,c=this,d=[],e=0,f="",g=c.$elem.children(),h=0,i=g.length;i>h;++h){var j=a(g[h]);if(j.hasClass("idl-menu-word")){var k=c.words[j.data("widx")];if(k.tfOff===e){void 0!==b&&(b.text=f.trim(),d.push(b),f=""),b={start:k.tfOff,len:k.endOff-k.tfOff,spcAft:!1};var l=j.data("fsk");l&&(b.fsk=l),e=k.endOff}f+=j.data("tok")}else{var m=c.gaps[j.data("gidx")];m.isWord&&m.tfOff===e?(void 0!==b&&(b.text=f.trim(),d.push(b),f=""),b={start:m.tfOff,len:1,spcAft:!1},e=m.endOffset()):m.isWord||m.tfOff!==e||void 0!==b&&(b.spcAft=!0),f+=j.text()}}return b.text=f.trim(),d.push(b),d},select:function(a,b){var c=this,d=a.data("widx");"undefined"!=typeof d&&c.words[d].setSelected(b)},deselect:function(a){var b=this,c=a.data("widx");"undefined"!=typeof c&&b.words[c].deselect()},deselectAll:function(){this.words.forEach(function(a){a.deselect()})},close:function(){this.words.forEach(function(a){a.close()})},destroy:function(){this.words.forEach(function(a){a.destroy()}),this.$elem.removeData("taggingMenu")},_getSenseCard:function(b){var c,d=this,e={tmplt:d.tmplt},f=b.$tile.data("fsk");e.fsk=c=f,c=c.replace(/\W/g,"");var g=d.sensecards[c];return void 0!==g?g:(a.ajax({data:e,type:"GET",url:d.options.apiUrl+"sensecard.js",dataType:"jsonp"}).done(function(a){var e=a.card;d.sensecards[c]=e,b._popover({content:e})}),"")},_create:function(){var c=this,d=a.extend({},c.options,{sensesel:function(a){return a.allset=!c.$elem.children(".idl-untagged").is(":visible"),c.options.informOnOther&&a.$selTile.hasClass("idl-tile-other")&&b.setTimeout(c.notifyOnOther,1e3,c,a),"function"==typeof c.options.sensesel?c.options.sensesel.call(this,a):!0}});"tile"===c.options.wordsContent?c.options.useToolTip&&alert('TaggingMenu "useToolTip" option should be false when "wordsContent" option is "tile".'):c.$elem.addClass("idl-text-mode"),c.options.useToolTip&&(void 0!==c.$elem.popover?c.$elem.on("mouseenter mouseleave",".idl-tagged",function(b){var d=a(this),e=c.words[d.data("widx")];if("mouseenter"===b.type){var f=c._getSenseCard(e);""!==f?e._popover({show:!0,content:f}):e._popover({show:!0})}else e._popover({show:!1})}):alert("Using tooltip without popover defined. Set useToolTip to false in options.")),c.options.menus.on("click",".idl-to-carousel, .idl-to-grid",function(b){var d=a(b.currentTarget).data("view");c.words.forEach(function(a){a.setView(d)}),b.stopPropagation()}),c.$elem.on("tm_itl_sensesel",function(a,b){c._senseSelHdlr(b)});var e=-1;c.$elem.children().each(function(b,f){var i=a(f);if(i.hasClass("idl-menu-word")){e=parseInt(i.data("off"),10);var j=Object.create(g),k=c.options.menus.children('[data-off="'+e+'"]');j.init(d,i,k);var l=c.words.length;i.data("widx",l),c.words[l]=j}else{var m=Object.create(h),n=i.data("off");e=void 0!==n?parseInt(n,10):e+1,m.init(i,e,void 0!==n),c.options.hideUntaggable&&i.text().trim().length&&i.addClass("hidden");var o=c.gaps.length;i.data("gidx",o),c.gaps[o]=m}});for(var f=0;f<c.words.length;++f){var i=c.words[f],j=i.selected();j?"sa"===c.options.preselect||"mono"===c.options.preselect&&!i.polysemous()?i.setSelected(j):j.removeClass("idl-sensesel"):i.$elem.is(":visible")&&i.$tile&&i.setSelected(i.$tile)}},_senseSelHdlr:function(b){for(var c=this,d=b.selEnd,e=Math.max(b.selEnd,b.prevEnd),f=b.$text.nextAll(),g=0;g<f.length;++g){var h=a(f[g]);if(h.hasClass("idl-menu-word")){var i=c.words[h.data("widx")],j=i.startOffset(),k=i.endOffset();if(j===e)break;d>j?h.hide():(d=k,"tile"===c.options.wordsContent&&i.$tile&&i.setSelected(i.$tile),h.show()),k>e&&(e=k)}else{var l=c.gaps[h.data("gidx")],m=l.tfOff;d>m?h.hide():(h.show(),d=l.endOffset())}}},notifyOnOther:function(b,c){a.get(b.options.apiUrl+"other_sense.js",{text:b.text(),word:c.$text.text()})}};a.fn.taggingMenu=function(b){return this.each(function(){var c=a(this),d=c.data("taggingMenu");void 0===d&&(d=Object.create(i),c.data("taggingMenu",d)),d.init(b,this)})},a.fn.taggingMenu.options={menus:null,useToolTip:!0,wordsContent:"text",hideUntaggable:!1,informOnOther:!0,closeOnSelect:!0,closeOnOutsideClick:!0,apiUrl:"https://api.idilia.com/1/kb/",preselect:"sa",senseMenuOptions:{},sensesel:null,sensedesel:null,createsel:null,beforeOpen:null,afterClose:null}}(jQuery,window,document);